<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <title>Calculadora de NÃ³mina Pro - Seguridad Certificada</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        .no-select { user-select: none; -webkit-user-select: none; }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        #modal-legal { display: none; }
    </style>
</head>
<body class="bg-slate-900 text-white min-h-screen font-sans flex flex-col no-select">

    <header class="p-6 bg-slate-800 border-b border-slate-700 text-center shadow-2xl relative z-10">
        <h1 class="text-2xl font-extrabold tracking-tight text-blue-400 uppercase">Calculadora de NÃ³mina</h1>
        <div class="flex justify-center items-center gap-2 mt-1">
            <span class="text-[9px] bg-green-500/20 text-green-400 px-2 py-0.5 rounded-full border border-green-500/30">
                <i class="fa-solid fa-lock"></i> PROCESAMIENTO LOCAL SEGURO
            </span>
        </div>
    </header>

    <main class="p-4 max-w-lg mx-auto mt-4 flex-grow w-full">
        <div class="flex bg-slate-800 p-1 rounded-xl mb-6 text-sm border border-slate-700 shadow-inner">
            <button onclick="setModo('mes')" id="btn-mes" class="flex-1 py-2 rounded-lg bg-blue-600 font-bold text-white transition-all duration-300">Mensual</button>
            <button onclick="setModo('semana')" id="btn-semana" class="flex-1 py-2 rounded-lg font-bold text-slate-400 transition-all duration-300">Semanal</button>
            <button onclick="setModo('horas')" id="btn-horas" class="flex-1 py-2 rounded-lg font-bold text-slate-400 transition-all duration-300">Por Horas</button>
        </div>

        <section class="space-y-4">
            <div>
                <label class="text-xs font-bold text-slate-500 uppercase ml-1 tracking-wider">PaÃ­s de Residencia Fiscal</label>
                <select id="pais" onchange="actualizarOpcionesAvanzadas()" class="w-full bg-slate-800 border border-slate-700 p-4 rounded-xl mt-1 focus:ring-2 focus:ring-blue-500 outline-none text-lg">
                    <option value="ES">EspaÃ±a ðŸ‡ªðŸ‡¸</option>
                    <option value="UK">Reino Unido ðŸ‡¬ðŸ‡§</option>
                    <option value="IT">Italia ðŸ‡®ðŸ‡¹</option>
                    <option value="PT">Portugal ðŸ‡µðŸ‡¹</option>
                </select>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label id="label-salario" class="text-xs font-bold text-slate-500 uppercase ml-1">Sueldo Bruto</label>
                    <input type="number" id="salario" step="0.01" class="w-full bg-slate-800 border border-slate-700 p-4 rounded-xl mt-1 text-lg outline-none focus:border-blue-500 shadow-inner" placeholder="0.00">
                </div>
                <div>
                    <label id="label-tiempo" class="text-xs font-bold text-slate-500 uppercase ml-1">Tiempo</label>
                    <input type="number" id="tiempo" class="w-full bg-slate-800 border border-slate-700 p-4 rounded-xl mt-1 text-lg outline-none focus:border-blue-500 shadow-inner" placeholder="Ej: 30">
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-xs font-bold text-slate-500 uppercase ml-1">Bonus/Extras</label>
                    <input type="number" id="bonus" class="w-full bg-slate-800 border border-slate-700 p-4 rounded-xl mt-1 outline-none focus:border-blue-500" placeholder="0.00">
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-500 uppercase ml-1">Prorrata</label>
                    <input type="number" id="prorrata" class="w-full bg-slate-800 border border-slate-700 p-4 rounded-xl mt-1 outline-none focus:border-blue-500" placeholder="0.00">
                </div>
            </div>

            <button onclick="toggleAvanzado()" class="w-full text-[10px] font-black text-slate-400 hover:text-blue-400 flex items-center justify-center py-3 border border-slate-800 rounded-xl mt-2 transition-all bg-slate-800/30 uppercase tracking-widest">
                <i class="fa-solid fa-sliders mr-2"></i> ConfiguraciÃ³n Fiscal EspecÃ­fica
            </button>

            <div id="panel-avanzado" class="bg-slate-800/80 border border-slate-700 rounded-2xl p-6 space-y-5 hidden shadow-2xl">
                <div id="adv-es" class="hidden">
                    <label class="text-xs font-bold text-blue-400 uppercase block mb-2">RetenciÃ³n IRPF Manual (%)</label>
                    <input type="number" id="irpf-manual" class="w-full bg-slate-900 border border-slate-600 p-3 rounded-xl text-lg outline-none focus:border-blue-500" placeholder="Auto">
                </div>
                <div id="adv-uk" class="hidden space-y-4">
                    <div>
                        <label class="text-xs font-bold text-blue-400 uppercase block mb-1">PensiÃ³n (%)</label>
                        <input type="number" id="pension-porcentaje" class="w-full bg-slate-900 border border-slate-600 p-3 rounded-xl" placeholder="Ej: 5">
                    </div>
                    <div class="flex items-center justify-between bg-slate-900 p-4 rounded-xl">
                        <label class="text-xs text-slate-300 uppercase font-bold text-[10px]">Second Job (BR)</label>
                        <input type="checkbox" id="check-second-job" class="w-6 h-6">
                    </div>
                </div>
                <div id="adv-it" class="hidden space-y-4">
                    <label class="text-xs font-bold text-blue-400 uppercase block">Addizionale Regionale (%)</label>
                    <input type="number" id="it-regional" class="w-full bg-slate-900 border border-slate-600 p-3 rounded-xl" placeholder="Ej: 1.5">
                </div>
                <div id="adv-pt" class="hidden space-y-4">
                    <label class="text-xs font-bold text-blue-400 uppercase block">Hijos a cargo</label>
                    <input type="number" id="pt-hijos" class="w-full bg-slate-900 border border-slate-600 p-3 rounded-xl" placeholder="0">
                </div>
            </div>

            <button onclick="ejecutarCalculoSeguro()" class="w-full bg-blue-600 hover:bg-blue-500 py-5 rounded-2xl text-xl font-black shadow-xl shadow-blue-900/40 active:scale-[0.98] transition-all mt-6 uppercase tracking-widest">
                Calcular Neto Pro
            </button>
        </section>

        <section id="result-card" class="hidden mt-8 bg-gradient-to-br from-blue-700 to-indigo-900 rounded-[2.5rem] p-8 shadow-2xl border border-white/10">
            <div class="text-white">
                <p class="text-[10px] font-black text-blue-200 uppercase tracking-widest mb-2">Neto Estimado</p>
                <h2 id="neto-display" class="text-5xl font-black mb-6 tracking-tighter">0.00</h2>
                <div class="space-y-4 text-sm border-t border-white/10 pt-6">
                    <div class="flex justify-between opacity-80"><span>Bruto:</span><span id="bruto-display">0.00</span></div>
                    <div class="flex justify-between text-red-200"><span>Seg. Social:</span><span id="ss-display">-0.00</span></div>
                    <div class="flex justify-between text-red-200"><span>Retenciones:</span><span id="tax-display">-0.00</span></div>
                </div>
            </div>
        </section>
    </main>

    <footer class="p-8 bg-slate-800/80 border-t border-slate-700 mt-12 text-center">
        <button onclick="abrirLegal()" class="text-[10px] font-bold text-blue-400 uppercase tracking-widest mb-4">
            <i class="fa-solid fa-scale-balanced mr-1"></i> Aviso Legal y Privacidad RGPD
        </button>
    </footer>

    <div id="modal-legal" class="fixed inset-0 bg-slate-950/98 z-50 p-6 flex-col overflow-y-auto">
        <div class="max-w-xl mx-auto w-full py-10">
            <h3 class="text-xl font-black text-blue-400 mb-6 uppercase">Privacidad y TÃ©rminos Legales</h3>
            <div class="space-y-4 text-[11px] text-slate-400 leading-relaxed text-justify">
                <p><strong>Responsabilidad:</strong> Los cÃ¡lculos mostrados son estimaciones informativas basadas en la legislaciÃ³n fiscal proyectada para 2026. Esta herramienta no sustituye la asesorÃ­a de un profesional.</p>
                <p><strong>Privacidad (RGPD):</strong> Esta aplicaciÃ³n NO utiliza cookies de rastreo ni almacena datos en servidores. El procesamiento se realiza exclusivamente en la memoria local de su navegador. Sus datos financieros nunca salen de su dispositivo.</p>
                <p><strong>Seguridad:</strong> Se utiliza cifrado SSL y protecciÃ³n contra inyecciones de cÃ³digo para garantizar la integridad de la sesiÃ³n.</p>
            </div>
            <button onclick="cerrarLegal()" class="w-full bg-blue-600 py-4 rounded-xl mt-8 font-bold uppercase text-xs">Acepto y Entiendo</button>
        </div>
    </div>

    <script>
        "use strict";
        let modoActual = 'mes';

        function setModo(modo) {
            modoActual = modo;
            ['mes', 'semana', 'horas'].forEach(m => {
                document.getElementById('btn-' + m).className = (m === modo) ? 'flex-1 py-2 rounded-lg bg-blue-600 font-bold text-white' : 'flex-1 py-2 rounded-lg font-bold text-slate-400';
            });
            document.getElementById('label-salario').textContent = (modo === 'horas') ? 'Precio/Hora' : 'Sueldo Bruto';
        }

        function toggleAvanzado() { document.getElementById('panel-avanzado').classList.toggle('hidden'); }
        function abrirLegal() { document.getElementById('modal-legal').style.display = 'flex'; }
        function cerrarLegal() { document.getElementById('modal-legal').style.display = 'none'; }

        function actualizarOpcionesAvanzadas() {
            const p = document.getElementById('pais').value;
            ['adv-es', 'adv-uk', 'adv-it', 'adv-pt'].forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById('adv-' + p.toLowerCase()).classList.remove('hidden');
        }

        function ejecutarCalculoSeguro() {
            try {
                const pais = document.getElementById('pais').value;
                const simb = (pais === 'UK') ? 'Â£' : 'â‚¬';
                
                // SanitizaciÃ³n estricta
                const s = Math.abs(parseFloat(document.getElementById('salario').value)) || 0;
                const t = Math.abs(parseFloat(document.getElementById('tiempo').value)) || 0;
                const b = Math.abs(parseFloat(document.getElementById('bonus').value)) || 0;
                const pr = Math.abs(parseFloat(document.getElementById('prorrata').value)) || 0;

                let bruto = (modoActual === 'horas') ? s * t : s;
                bruto += b + pr;

                let ss = 0, tax = 0;

                if(pais === 'ES') {
                    ss = bruto * 0.0647;
                    const m = document.getElementById('irpf-manual').value;
                    tax = (m !== "") ? bruto * (parseFloat(m)/100) : (bruto * 0.16);
                } else if(pais === 'UK') {
                    ss = (bruto > 1048) ? (bruto - 1048) * 0.08 : 0;
                    tax = (document.getElementById('check-second-job').checked) ? bruto * 0.20 : (bruto > 1047 ? (bruto - 1047) * 0.20 : 0);
                } else if(pais === 'IT') {
                    ss = bruto * 0.0919;
                    tax = bruto * 0.25; // AproximaciÃ³n IRPEF 2026
                } else if(pais === 'PT') {
                    ss = bruto * 0.11;
                    tax = bruto * 0.18; // AproximaciÃ³n IRS 2026
                }

                const neto = bruto - ss - tax;

                // Renderizado seguro contra XSS
                document.getElementById('bruto-display').textContent = bruto.toFixed(2) + simb;
                document.getElementById('neto-display').textContent = neto.toFixed(2) + simb;
                document.getElementById('ss-display').textContent = '-' + ss.toFixed(2) + simb;
                document.getElementById('tax-display').textContent = '-' + tax.toFixed(2) + simb;
                document.getElementById('result-card').classList.remove('hidden');
                
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            } catch (e) { console.error("Error de integridad"); }
        }

        // ProtecciÃ³n de marcos (Anti-Clickjacking)
        if (window.top !== window.self) { window.top.location = window.self.location; }
    </script>
</body>
</html>
