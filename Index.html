<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de NÃ³mina</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-slate-900 text-white min-h-screen font-sans pb-10">

    <header class="p-6 bg-slate-800 border-b border-slate-700 text-center">
        <h1 class="text-2xl font-extrabold tracking-tight text-blue-400">CALCULADORA DE NÃ“MINA</h1>
    </header>

    <main class="p-4 max-w-lg mx-auto mt-4">

        <div class="flex bg-slate-800 p-1 rounded-xl mb-6 text-sm">
            <button onclick="setModo('mes')" id="btn-mes" class="flex-1 py-2 rounded-lg bg-blue-600 font-bold text-white transition">Mensual</button>
            <button onclick="setModo('semana')" id="btn-semana" class="flex-1 py-2 rounded-lg font-bold text-slate-400 transition">Semanal</button>
            <button onclick="setModo('horas')" id="btn-horas" class="flex-1 py-2 rounded-lg font-bold text-slate-400 transition">Por Horas</button>
        </div>

        <section class="space-y-4">
            <div>
                <label class="text-xs font-bold text-slate-400 uppercase">PaÃ­s de Residencia</label>
                <select id="pais" onchange="actualizarOpcionesAvanzadas()" class="w-full bg-slate-800 border border-slate-700 p-3 rounded-xl mt-1 focus:ring-2 focus:ring-blue-500 outline-none">
                    <option value="ES">EspaÃ±a ðŸ‡ªðŸ‡¸</option>
                    <option value="UK">Reino Unido ðŸ‡¬ðŸ‡§</option>
                    <option value="IT">Italia ðŸ‡®ðŸ‡¹</option>
                    <option value="PT">Portugal ðŸ‡µðŸ‡¹</option>
                </select>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label id="label-salario" class="text-xs font-bold text-slate-400 uppercase">Salario Base</label>
                    <input type="number" id="salario" class="w-full bg-slate-800 border border-slate-700 p-3 rounded-xl mt-1 text-lg outline-none focus:border-blue-500" placeholder="0.00">
                </div>
                <div>
                    <label id="label-tiempo" class="text-xs font-bold text-slate-400 uppercase">DÃ­as trabajados</label>
                    <input type="number" id="tiempo" class="w-full bg-slate-800 border border-slate-700 p-3 rounded-xl mt-1 text-lg outline-none focus:border-blue-500" placeholder="Ej: 30">
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-xs font-bold text-slate-400 uppercase">Bonus Extra</label>
                    <input type="number" id="bonus" class="w-full bg-slate-800 border border-slate-700 p-3 rounded-xl mt-1 outline-none focus:border-blue-500" placeholder="Opcional">
                </div>
                <div>
                    <label class="text-xs font-bold text-slate-400 uppercase">Prorrata Vacaciones</label>
                    <input type="number" id="prorrata" class="w-full bg-slate-800 border border-slate-700 p-3 rounded-xl mt-1 outline-none focus:border-blue-500" placeholder="Opcional">
                </div>
            </div>

            <button id="btn-avanzado" onclick="toggleAvanzado()" class="w-full text-sm text-slate-400 hover:text-white flex items-center justify-center py-3 border border-slate-700 rounded-lg mt-2 transition" style="display: flex;">
                <i class="fa-solid fa-sliders mr-2"></i> Opciones Avanzadas
            </button>

            <div id="panel-avanzado" class="bg-slate-800 border border-slate-700 rounded-xl p-5 space-y-4" style="display: none;">
                
                <div id="adv-es" style="display: none;">
                    <label class="text-xs font-bold text-blue-400 uppercase block mb-1">IRPF Manual (%)</label>
                    <p class="text-xs text-slate-400 mb-3">Si tienes discapacidad o exenciÃ³n, escribe tu porcentaje. Si lo dejas vacÃ­o, usaremos las tablas oficiales.</p>
                    <input type="number" id="irpf-manual" class="w-full bg-slate-900 border-2 border-slate-600 p-3 rounded-xl text-lg outline-none focus:border-blue-500" placeholder="Ej: 0, 2, 15...">
                </div>

                <div id="adv-uk" style="display: none;">
                    <div class="mb-5">
                        <label class="text-xs font-bold text-blue-400 uppercase block mb-1">PensiÃ³n Auto-Enrolment (%)</label>
                        <p class="text-xs text-slate-400 mb-3">Si cotizas a pensiÃ³n privada, escribe el porcentaje. Si no, dÃ©jalo vacÃ­o.</p>
                        <input type="number" id="pension-porcentaje" class="w-full bg-slate-900 border-2 border-slate-600 p-3 rounded-xl text-lg outline-none focus:border-blue-500" placeholder="Ej: 5">
                    </div>
                    <div class="flex items-center justify-between border-t border-slate-700 pt-4">
                        <div class="pr-4">
                            <label class="text-xs font-bold text-blue-400 uppercase block">Segundo Empleo (BR Code)</label>
                            <p class="text-xs text-slate-400 mt-1">Elimina el mÃ­nimo exento (Â£12,570).</p>
                        </div>
                        <input type="checkbox" id="check-second-job" class="w-6 h-6 accent-blue-500">
                    </div>
                </div>

            </div>

            <button onclick="calcular()" class="w-full bg-blue-600 py-4 rounded-2xl text-xl font-black shadow-lg shadow-blue-900/20 active:scale-95 transition-transform mt-6">
                CALCULAR NETO
            </button>
        </section>

        <section id="result-card" class="hidden mt-8 bg-gradient-to-br from-blue-600 to-blue-800 rounded-3xl p-6 shadow-2xl relative overflow-hidden">
            <div class="relative z-10 text-white">
                <p class="text-sm opacity-80 font-bold uppercase mb-1">Neto Estimado</p>
                <h2 id="neto-display" class="text-4xl font-black mb-4">0.00</h2>
                
                <div class="space-y-2 text-sm border-t border-blue-400/30 pt-4">
                    <div class="flex justify-between text-blue-200"><span>Bruto Total:</span><span id="bruto-display">0.00</span></div>
                    <div class="flex justify-between text-red-300"><span>Seguridad Social/NI:</span><span id="ss-display">-0.00</span></div>
                    <div class="flex justify-between text-red-300"><span>Impuestos (IRPF/Tax):</span><span id="tax-display">-0.00</span></div>
                    <div id="row-pension" class="flex justify-between text-yellow-300 hidden"><span>PensiÃ³n Privada:</span><span id="pension-display">-0.00</span></div>
                </div>
            </div>
        </section>
    </main>

    <script>
        let modoActual = 'mes';

        // Inicializar la vista correcta al cargar la pÃ¡gina
        window.onload = function() {
            actualizarOpcionesAvanzadas();
        };

        // Cambiar entre Mes, Semana, Horas
        function setModo(modo) {
            modoActual = modo;
            const botones = ['mes', 'semana', 'horas'];
            botones.forEach(b => {
                const btn = document.getElementById(`btn-${b}`);
                if(b === modo) {
                    btn.classList.replace('text-slate-400', 'text-white');
                    btn.classList.replace('bg-transparent', 'bg-blue-600');
                    if(!btn.classList.contains('bg-blue-600')) btn.classList.add('bg-blue-600');
                } else {
                    btn.classList.replace('text-white', 'text-slate-400');
                    btn.classList.remove('bg-blue-600');
                }
            });

            const labelSalario = document.getElementById('label-salario');
            const labelTiempo = document.getElementById('label-tiempo');
            const inputTiempo = document.getElementById('tiempo');

            if(modo === 'mes') {
                labelSalario.innerText = 'Salario Mensual';
                labelTiempo.innerText = 'DÃ­as trabajados';
                inputTiempo.placeholder = 'Ej: 30';
            } else if(modo === 'semana') {
                labelSalario.innerText = 'Salario Semanal';
                labelTiempo.innerText = 'DÃ­as trabajados';
                inputTiempo.placeholder = 'Ej: 5';
            } else if(modo === 'horas') {
                labelSalario.innerText = 'Precio por Hora';
                labelTiempo.innerText = 'Horas totales';
                inputTiempo.placeholder = 'Ej: 40';
            }
        }

        // Mostrar/Ocultar Opciones Avanzadas (BotÃ³n)
        function toggleAvanzado() {
            const panel = document.getElementById('panel-avanzado');
            if (panel.style.display === 'none' || panel.style.display === '') {
                panel.style.display = 'block';
            } else {
                panel.style.display = 'none';
            }
        }

        // Mostrar el panel avanzado correcto segÃºn el paÃ­s y ocultar si no hay opciones
        function actualizarOpcionesAvanzadas() {
            const pais = document.getElementById('pais').value;
            const btnAvanzado = document.getElementById('btn-avanzado');
            const panelAvanzado = document.getElementById('panel-avanzado');
            const advEs = document.getElementById('adv-es');
            const advUk = document.getElementById('adv-uk');

            // Ocultar contenidos internos por defecto
            advEs.style.display = 'none';
            advUk.style.display = 'none';

            if (pais === 'ES') {
                btnAvanzado.style.display = 'flex';
                advEs.style.display = 'block';
            } else if (pais === 'UK') {
                btnAvanzado.style.display = 'flex';
                advUk.style.display = 'block';
            } else {
                // IT y PT no tienen panel avanzado, ocultamos el botÃ³n y el panel
                btnAvanzado.style.display = 'none';
                panelAvanzado.style.display = 'none';
            }
        }

        // LÃ³gica Principal de CÃ¡lculo
        function calcular() {
            const pais = document.getElementById('pais').value;
            const simbolo = (pais === 'UK') ? 'Â£' : 'â‚¬';
            
            const salarioInput = parseFloat(document.getElementById('salario').value) || 0;
            const tiempoInput = parseFloat(document.getElementById('tiempo').value) || 0;
            const bonus = parseFloat(document.getElementById('bonus').value) || 0;
            const prorrata = parseFloat(document.getElementById('prorrata').value) || 0;
            
            // 1. Calcular Bruto Base
            let baseSalarial = 0;
            if (modoActual === 'horas') {
                baseSalarial = salarioInput * tiempoInput; 
            } else {
                baseSalarial = salarioInput; 
            }

            const totalBruto = baseSalarial + bonus + prorrata;

            let ssDescuento = 0;
            let taxDescuento = 0;
            let pensionDescuento = 0;

            // 2. LÃ³gica por PaÃ­s
            if (pais === 'ES') {
                // ESPAÃ‘A
                ssDescuento = totalBruto * 0.0647; // SS Trabajador
                
                const irpfManualInput = document.getElementById('irpf-manual').value;
                if (irpfManualInput !== "") {
                    // Calculo exacto si el usuario puso un nÃºmero (incluso 0)
                    taxDescuento = totalBruto * (parseFloat(irpfManualInput) / 100);
                } else {
                    // Tablas IRPF automÃ¡ticas
                    if (totalBruto < 1000) taxDescuento = totalBruto * 0.02;
                    else if (totalBruto < 1500) taxDescuento = totalBruto * 0.10;
                    else if (totalBruto < 2500) taxDescuento = totalBruto * 0.15;
                    else taxDescuento = totalBruto * 0.20;
                }

            } else if (pais === 'UK') {
                // REINO UNIDO
                const pensionPorcentaje = parseFloat(document.getElementById('pension-porcentaje').value) || 0;
                pensionDescuento = totalBruto * (pensionPorcentaje / 100);

                ssDescuento = totalBruto > 1048 ? (totalBruto - 1048) * 0.08 : 0; 

                const isSecondJob = document.getElementById('check-second-job').checked;
                
                if (isSecondJob) {
                    taxDescuento = totalBruto * 0.20;
                } else {
                    let allowance = 1047.50; 
                    if (modoActual === 'semana') allowance = 241.73; 
                    
                    let baseImponible = totalBruto - allowance;
                    if (baseImponible < 0) baseImponible = 0;
                    taxDescuento = baseImponible * 0.20;
                }

            } else {
                // Italia / Portugal (GenÃ©rico)
                let taxRate = (pais === 'IT') ? 0.23 : 0.15;
                let ssRate = (pais === 'IT') ? 0.09 : 0.11;
                ssDescuento = totalBruto * ssRate;
                taxDescuento = (totalBruto - ssDescuento) * taxRate;
            }

            if(taxDescuento < 0) taxDescuento = 0;
            if(ssDescuento < 0) ssDescuento = 0;

            // 3. Calcular Neto
            const netoFinal = totalBruto - ssDescuento - taxDescuento - pensionDescuento;

            // 4. Mostrar Resultados
            document.getElementById('bruto-display').innerText = totalBruto.toFixed(2) + simbolo;
            document.getElementById('neto-display').innerText = netoFinal.toFixed(2) + simbolo;
            document.getElementById('ss-display').innerText = '-' + ssDescuento.toFixed(2) + simbolo;
            document.getElementById('tax-display').innerText = '-' + taxDescuento.toFixed(2) + simbolo;
            
            const rowPension = document.getElementById('row-pension');
            if(pensionDescuento > 0) {
                rowPension.classList.remove('hidden');
                document.getElementById('pension-display').innerText = '-' + pensionDescuento.toFixed(2) + simbolo;
            } else {
                rowPension.classList.add('hidden');
            }

            document.getElementById('result-card').classList.remove('hidden');
        }
    </script>
</body>
</html>
